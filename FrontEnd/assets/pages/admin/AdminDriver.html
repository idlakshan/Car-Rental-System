<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Drivers</title>
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <link rel="stylesheet" href="../admin/css/driver.css">
  <link rel="stylesheet" href="../../boostrap/css/bootstrap.min.css">
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <link rel="stylesheet" href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">
</head>
<body>
<input type="checkbox" id="menu-toggle">
<div class="sidebar">
  <div class="side-header">
    <h3>Car<span>Rental</span></h3>
  </div>

  <div class="side-content">
    <div class="profile">
      <div class="profile-img bg-img" style="background-image: url(img/me.jpg)"></div>
      <h4>Dimuthu lakshan</h4>
      <small>Administrator</small>
    </div>

    <div class="side-menu">
      <ul>
        <li>
          <a href="AdminDashboard.html" >
            <span class="las la-home"></span>
            <small>Dashboard</small>
          </a>
        </li>
        <li>
          <a href="AdminCars.html" >
            <span class="bx bx-car"></span>
            <small>Manage Cars</small>
          </a>
        </li>
        <li>
          <a href="AdminUser.html" >
            <span class="bx bx-group"></span>
            <small>Manage Users</small>
          </a>
        </li>
        <li>
          <a href="AdminDriver.html" class="active">
            <span class="bx bx-male"></span>
            <small>Manage Drivers</small>
          </a>
        </li>

      </ul>
    </div>
  </div>
</div>
<div class="main-content">
  <header>
    <div class="header-content">
      <label for="menu-toggle">
        <span class="las la-bars"></span>
      </label>

      <div class="header-menu">

        <div class="notify-icon">
          <span class="las la-envelope"></span>
          <span class="notify">4</span>
        </div>

        <div class="notify-icon">
          <span class="las la-bell"></span>
          <span class="notify">3</span>
        </div>

        <div class="user">
          <div class="bg-img" style="background-image: url(img/me.jpg)"></div>

          <a href="../../../index.html" style="text-decoration: none; color: #f25656">
            <span class="las la-power-off"></span>
            <span>Logout</span>
          </a>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="page-header">
      <h1>Dashboard</h1>
      <small>Drivers / Dashboard</small>
    </div>

    <div id="page-content-wrapper">
      <button class="hamburger animated fadeInLeft is-closed" data-toggle="offcanvas" type="button">
        <span class="hamb-top"></span>
        <span class="hamb-middle"></span>
        <span class="hamb-bottom"></span>
      </button>
      <div class="container">
        <div class="row">
          <div class="col-lg-12 col-lg-offset-2 ">
            <div class="container-fluid">
              <div class="row">
                <div class="col-12">
                  <div class="container">
                    <div class="row d-flex justify-content-center">
                      <div class="col-8 mt-3">
                        <form id="driverForm">
                          <div class="row">
                            <div class="mb-3 col-6">
                              <label class="form-label" for="txtDriverId">Driver
                                ID</label>
                              <input class="form-control" id="txtDriverId" placeholder="Driver ID"  type="text" name="driverId">
                            </div>

                            <div class="mb-3 col-6">
                              <label class="form-label" for="txtDriverFirstName">First
                                Name </label>
                              <input class="form-control" id="txtDriverFirstName"
                                     placeholder="First Name"
                                     type="search" name="driverFirstName">
                            </div>

                            <div class="mb-3 col-6">
                              <label class="form-label" for="txtDriverLastName">Last
                                Name</label>
                              <input class="form-control" id="txtDriverLastName"
                                     placeholder="Last Name"
                                     type="search" name="driverLastName">
                            </div>

                            <div class="mb-3 col-6">
                              <label class="form-label" for="txtContactNum">Contact
                                Number</label>
                              <input class="form-control" id="txtContactNum"
                                     placeholder="Contact"
                                     type="search" name="driverContactNum">
                            </div>

                            <div class="mb-3 col-6">
                              <label class="form-label" for="txtEmailAddress">Email
                                Address</label>
                              <input class="form-control" id="txtEmailAddress"
                                     placeholder="Email"
                                     type="search" name="driverEmail">
                            </div>

                            <div class="mb-3 col-6">
                              <label class="form-label" for="txtAddress">Address</label>
                              <input class="form-control" id="txtAddress"
                                     placeholder="Address"
                                     type="search" name="driverAddress">
                            </div>

                            <div class="mb-3 col-6">
                              <label class="form-label" for="txtDriverLicense">Driving
                                License Number</label>
                              <input class="form-control" id="txtDriverLicense"
                                     placeholder="Driving License"
                                     type="search" name="driverLicense">
                            </div>


                            <div class="mb-3 col-6">
                              <label class="form-label" for="txtNicNum">NIC Number</label>
                              <input class="form-control" id="txtNicNum"
                                     placeholder="NIC"
                                     type="search" name="driverNic">
                            </div>



                            <div class="mb-3 col-6">
                              <label class="form-label" for="txtPassword">Password</label>
                              <input class="form-control" id="txtPassword"
                                     placeholder="Password"
                                     type="search" name="driverPassword">
                            </div>


                            <div class="col-12 d-flex justify-content-center">
                              <button class="btn btn-outline-primary btn-sm w-25 mb-4 mt-2"
                                      id="btnSaveDriver"
                                      type="button" style="margin-right:15px ">Save Driver
                              </button>
                              <button class="btn btn btn-outline-danger btn-sm w-25 mb-4 mt-2"
                                      id="btnDeleteDriver"
                                      type="button" style="margin-left: 15px">Delete Driver
                              </button>
                            </div>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class=" justify-content-center">
      <table class="table table-striped table-hover table-sm" style="margin-top: 5px;margin-bottom: 20px">
        <thead>
        <tr>
          <th><span class="las la-sort"></span>Driver ID</th>
          <th> <span class="las la-sort"></span>First Name</th>
          <th><span class="las la-sort"></span>Last Name </th>
          <th><span class="las la-sort"></span>Contact No</th>
          <th><span class="las la-sort"></span>Email</th>
          <th><span class="las la-sort"></span>Address</th>
          <th><span class="las la-sort"></span>License No</th>
          <th><span class="las la-sort"></span>Nic</th>
          <th><span class="las la-sort"></span>Password</th>
        </tr>
        </thead>
        <tbody id="tblDriver">

        </tbody>
      </table>
    </div>

  </main>
</div>


<script src="../../boostrap/js/bootstrap.bundle.min.js"></script>
<script src="../../JQuery/jquery-3.6.1.min.js"></script>
<script>
  var newDriverId;

  loadAllDrivers();
  createNewDriverId();

  function clearDriverTextFields() {
    $("#txtDriverFirstName").val("");
    $("#txtDriverLastName").val("");
    $("#txtContactNum").val("");
    $("#txtEmailAddress").val("");
    $("#txtAddress").val("");
    $("#txtDriverLicense").val("");
    $("#txtNicNum").val("");
    $("#txtPassword").val("");
  }


  $("#btnSaveDriver").click(function (){

    let driverId = $("#txtDriverId").val();
    let driverFirstName = $("#txtDriverFirstName").val();
    let driverLastName = $("#txtDriverLastName").val();
    let driverContactNum = $("#txtContactNum").val();
    let driverEmailAddress = $("#txtEmailAddress").val();
    let driverAddress = $("#txtAddress").val();
    let drivingLicense = $("#txtDriverLicense").val();
    let nicNum = $("#txtNicNum").val();
    let userName = $("#txtUserName").val();
    let password = $("#txtPassword").val();

    driver = {
      driverId: driverId,
      driverName: {
        driverFirstName: driverFirstName,
        driverLastName: driverLastName,
      },
      driverAddress: driverAddress,
      driverEmail: driverEmailAddress,
      driverContactNum: driverContactNum,
      driverNic: nicNum,
      driverLicense: drivingLicense,
      driverUserName: userName,
      driverPassword: password
    }

    $.ajax({
      url:"http://localhost:8080/Easy_Car_Rental_war/driver",
      method:"post",
      contentType:"application/json",
      data:JSON.stringify(driver),
      dataType:"json",
      success:function (resp){
        alert(resp.message);
        loadAllDrivers();
        clearDriverTextFields();
        createNewDriverId();
      },error:function (error){
        alert(JSON.parse(error.responseText).message);
      }

    });
  });

 function loadAllDrivers(){
   $("#tblDriver").empty();

   $.ajax({
     url:"http://localhost:8080/Easy_Car_Rental_war/driver",
     method: "get",
     dataType:"json",
     success:function (resp){
       for (let driver of resp.data) {
         // console.log(resp.data);
         let row = `<tr><td>${driver.driverId}</td><td>${driver.driverName.driverFirstName}</td><td>${driver.driverName.driverLastName}</td><td>${driver.driverContactNum}</td><td>${driver.driverEmail}</td><td>${driver.driverAddress} </td><td> ${driver.driverLicense}</td><td>${driver.driverNic}</td><td>${driver.driverPassword} </td></tr>`;
         $("#tblDriver").append(row);
       }

       bindRowAdminClickEvent();
     }

   });
 }

  function createNewDriverId() {
    $.ajax({
      url: "http://localhost:8080/Easy_Car_Rental_war/driver/driverId",
      dataType: "json",
      async: false,
      success: function (resp) {
        let lastDriverId = resp.data;

        let tempId = parseInt(lastDriverId.split("-")[1]);
        tempId = tempId + 1;

        if (tempId < 9) {

          newDriverId = "D-00" + tempId;

        } else if (tempId < 99) {
          newDriverId = "D-0" + tempId;

        } else {
          newDriverId = "D-" + tempId;

        }

        $("#txtDriverId").val(newDriverId);
      },
      error: function (error) {
        alert("Error When Getting Last Driver ID From Back End!!");
      }
    });
  }

  function bindRowAdminClickEvent(){
    $("#tblDriver>tr").click(function (){
      let driverId=$(this).children(":eq(0)").text();
      let driverFirstName=$(this).children(":eq(1)").text();
      let driverLastName=$(this).children(":eq(2)").text();
      let driverContact=$(this).children(":eq(3)").text();
      let driverEmail=$(this).children(":eq(4)").text();
      let driverAddress=$(this).children(":eq(5)").text();
      let driverLicense=$(this).children(":eq(6)").text();
      let driverNic=$(this).children(":eq(7)").text();
      let driverPassword=$(this).children(":eq(8)").text();


      $("#txtDriverId").val(driverId);
      $("#txtDriverFirstName").val(driverFirstName);
      $("#txtDriverLastName").val(driverLastName);
      $("#txtContactNum").val(driverContact);
      $("#txtEmailAddress").val(driverEmail);
      $("#txtAddress").val(driverAddress)
      $("#txtDriverLicense").val(driverLicense)
      $("#txtNicNum").val(driverNic)
      $("#txtPassword").val(driverPassword)

    });
  }

  $("#btnDeleteDriver").click(function (){
    let id = $("#txtDriverId").val();
    $.ajax({
      url: "http://localhost:8080/Easy_Car_Rental_war/driver?id="+id,
      method:"delete",
      dataType:"json",
      success:function (resp){
        alert(resp.message);
        loadAllDrivers()
        clearDriverTextFields();
        createNewDriverId();
      },error:function (error){
        alert(JSON.parse(error.responseText).message);
      }


    });
  });



</script>

</body>
</html>